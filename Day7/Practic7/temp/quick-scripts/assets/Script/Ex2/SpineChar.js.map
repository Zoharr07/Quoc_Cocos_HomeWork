{"version":3,"sources":["SpineChar.js"],"names":["cc","Class","extends","Component","properties","spAnim","sp","Skeleton","bullet","Prefab","mainNode","Node","_canMove","_canJump","jumpHeight","jumpDuration","jumpDistance","accel","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","setMix","start","update","dt","onCollisionEnter","other","self","console","log","tag","_jump","_shot","onCollisionStay","onCollisionExit","_moveLeft","node","scaleX","tween","call","setAnimation","by","position","v2","addAnimation","_moveRight","jumpAction","setJumpAction","runAction","direct","instantiate","addChild","x","y","distance","jump","jumpBy","sequence","callFunc","event","keyCode","macro","KEY","left","right","space"],"mappings":"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","file":"SpineChar.js","sourceRoot":"../../../../../assets/Script/Ex2","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        spAnim: sp.Skeleton,\n        bullet: cc.Prefab,\n        mainNode: cc.Node,\n        _canMove: true,\n        _canJump: true,\n\n        jumpHeight: 60,\n        jumpDuration: 1.2,\n        jumpDistance: 60,\n        accel: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        this.spAnim.setMix('idle', 'walk', 0.2);\n        this.spAnim.setMix('walk', 'idle', 0.2);\n    },\n\n    start() {\n        // this.spAnim.setAnimation(0, 'walk', true);\n    },\n\n    update(dt) {\n        // if (this.canMove) this.node.x += dt * 80;\n\n    },\n\n    onCollisionEnter: function (other, self) {\n        console.log('on collision enter');\n        cc.log(other, self);\n        if (self.tag == 0 && other.tag == 2) {\n            this._jump();\n        }\n        if (other.tag === 3) {\n            this._canMove = false;\n            this._shot(other, self);\n\n        }\n    },\n\n    onCollisionStay: function (other, self) {\n        console.log('on collision stay');\n        if (other.tag === 2) {\n\n        }\n    },\n\n    onCollisionExit: function (other, self) {\n        console.log('on collision exit');\n        // if (other.tag == 2) {\n        //     cc.tween(this.node)\n        //         .delay(0.4)\n        //         .call(() => {\n        //             this.spAnim.setAnimation(0, 'walk', true);\n        //             this.canMove = true;\n        //         })\n        //         .start()\n        // }\n\n    },\n\n\n    _moveLeft() {\n        if (this.node.scaleX > 0) this.node.scaleX *= -1;\n        if (this._canMove == false) return;\n        this._canMove = false;\n        cc.tween(this.node)\n            .call(() => {\n                this.spAnim.setAnimation(0, 'walk', false);\n            })\n            .by(0.8, { position: cc.v2(-30, 0) })\n            .call(() => {\n                this.spAnim.addAnimation(0, 'idle', true);\n                this._canMove = true;\n            })\n            .start();\n\n\n    },\n    _moveRight() {\n        if (this.node.scaleX < 0) this.node.scaleX *= -1;\n        if (this._canMove == false) return;\n        this._canMove = false;\n        cc.tween(this.node)\n            .call(() => {\n                this.spAnim.setAnimation(0, 'walk', false);\n            })\n            .by(0.8, { position: cc.v2(30, 0) })\n            .call(() => {\n                this.spAnim.addAnimation(0, 'idle', true);\n            })\n            .call(() => {\n                this._canMove = true;\n            })\n            .start();\n\n\n    },\n\n    _jump() {\n        cc.log(this._canJump)\n        if (this._canJump == false) return;\n        this._canJump = false;\n        this._canMove = false;\n        this.jumpAction = this.setJumpAction();\n        this.node.runAction(this.jumpAction);\n    },\n\n    _shot(other, self) {\n        let direct = 1;\n        if (this.node.scaleX < 0) direct = -1;\n        this.spAnim.setAnimation(0, 'shoot', false);\n        let bullet = cc.instantiate(this.bullet)\n        this.mainNode.addChild(bullet);\n        bullet.position = cc.v2(this.node.x + 20 * direct, this.node.y + 25);\n        cc.tween(bullet)\n            .by(10, { position: cc.v2(1000 * direct, 0) }).start();\n    },\n\n    setJumpAction: function () {\n        let distance = this.jumpDistance;\n        if (this.node.scaleX < 0) distance *= -1;\n        let jump = cc.jumpBy(this.jumpDuration, cc.v2(distance, 0), this.jumpHeight, 1)\n        return cc.sequence(\n            cc.callFunc(() => {\n                this.spAnim.setAnimation(0, 'jump', false);\n            }),\n            jump,\n            cc.callFunc(() => {\n                this.spAnim.setAnimation(0, 'idle', true);\n            }),\n            cc.callFunc(() => {\n                this._canMove = true;\n                this._canJump = true;\n            }),\n        );\n    },\n\n\n    onKeyDown(event) {\n        //if (!this._canGetKey) return;\n        switch (event.keyCode) {\n            case cc.macro.KEY.left:\n                console.log('Press left key');\n                this._moveLeft();\n                break;\n            case cc.macro.KEY.right:\n                console.log('Press right key');\n                this._moveRight();\n                break;\n            case cc.macro.KEY.space:\n                console.log('Press space key');\n                this._shot();\n                break;\n\n        }\n    },\n});\n"]}