window.__require=function t(e,n,i){function o(s,c){if(!n[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var u="function"==typeof __require&&__require;if(!c&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){return o(e[s][1][t]||t)},l,l.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){"use strict";var i,o="object"==typeof Reflect?Reflect:null,r=o&&"function"==typeof o.apply?o.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};function s(t){console&&console.warn&&console.warn(t)}i=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var c=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(t,e){return new Promise(function(n,i){function o(n){t.removeListener(e,r),i(n)}function r(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}y(t,e,r,{once:!0}),"error"!==e&&U(t,o,{once:!0})})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function l(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function d(t,e,n,i){var o,r,c;if(l(n),void 0===(r=t._events)?(r=t._events=Object.create(null),t._eventsCount=0):(void 0!==r.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),c=r[e]),void 0===c)c=r[e]=n,++t._eventsCount;else if("function"==typeof c?c=r[e]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(o=h(t))>0&&c.length>o&&!c.warned){c.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=c.length,s(a)}return t}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=f.bind(i);return o.listener=n,i.wrapFn=o,o}function v(t,e,n){var i=t._events;if(void 0===i)return[];var o=i[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?b(o):m(o,o.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function g(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function b(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function U(t,e,n){"function"==typeof t.on&&y(t,"error",e,n)}function y(t,e,n,i){if("function"==typeof t.on)i.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function o(r){i.once&&t.removeEventListener(e,o),n(r)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(t){if("number"!=typeof t||t<0||c(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");u=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||c(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var a=o[t];if(void 0===a)return!1;if("function"==typeof a)r(a,this,e);else{var u=a.length,l=m(a,u);for(n=0;n<u;++n)r(l[n],this,e)}return!0},a.prototype.addListener=function(t,e){return d(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return d(this,t,e,!0)},a.prototype.once=function(t,e){return l(e),this.on(t,_(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return l(e),this.prependListener(t,_(this,t,e)),this},a.prototype.removeListener=function(t,e){var n,i,o,r,s;if(l(e),void 0===(i=this._events))return this;if(void 0===(n=i[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===e||n[r].listener===e){s=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():g(n,o),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",t,s||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},a.prototype.listeners=function(t){return v(this,t,!0)},a.prototype.rawListeners=function(t){return v(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},{}],Emitter:[function(t,e,n){"use strict";cc._RF.push(e,"4a5abLU09FNzZRFPgaW32wn","Emitter");var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=t("Events"),s=function(){function t(){o(this,t),this._emitter=new r,this._emitter.setMaxListeners(100)}return i(t,[{key:"emit",value:function(){var t;(t=this._emitter).emit.apply(t,arguments)}},{key:"addEvent",value:function(t,e){this._emitter.on(t,e)}},{key:"addOneEvent",value:function(t,e){this._emitter.once(t,e)}},{key:"removeEvent",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"destroy",value:function(){this._emitter.removeAllListeners(),this._emitter=null,t.instance=null}}]),t}();s.instance=null,e.exports=s,cc._RF.pop()},{Events:1}],EventController:[function(t,e,n){"use strict";cc._RF.push(e,"a9b47JziytG65lURDMgrLCC","EventController");var i=t("Emitter");cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.instance=new i}}),cc._RF.pop()},{Emitter:"Emitter"}],GameController:[function(t,e,n){"use strict";cc._RF.push(e,"35fcbcIcmhHL5aekjDe2BLq","GameController");var i=t("Emitter");cc.Class({extends:cc.Component,properties:{unitBG:cc.Prefab,unitPrefabs:cc.Prefab,boardUnit:cc.Node,nodeBG:cc.Node,scoreTotal:cc.Label,bestScore:cc.Label,_boardPosition:[],_boardUnitArgs:[],_row:4,_col:4,_distance:200,_maxObj:0,_canMoveBoard:!0,_canInstanceUnit:!1},onLoad:function(){i.instance.addEvent("startGame",this._startGameFunc.bind(this)),i.instance.addEvent("moveUp",this._moveUp.bind(this)),i.instance.addEvent("moveDown",this._moveDown.bind(this)),i.instance.addEvent("moveLeft",this._moveLeft.bind(this)),i.instance.addEvent("moveRight",this._moveRight.bind(this)),this.instanceBackgroundUnit(),this._instanceBoardArray(),this._clearBoardGame()},instanceRandomUnit:function(){if(this._maxObj++,!(this._maxObj>this._row*this._col)){var t=0,e=0;for(i();null!=this._boardUnitArgs[t][e];)i();var n=cc.instantiate(this.unitPrefabs);this._boardUnitArgs[t][e]=n,this.boardUnit.addChild(n),n.position=this._boardPosition[t][e],n.setUnitValue(function(){var t=Math.random();return t=t>.5?4:2}())}function i(){t=Math.floor(4*Math.random()),e=Math.floor(4*Math.random())}},_instanceUnit:function(){var t=this;i.instance.emit("playSoundSlide"),cc.tween(this.node).delay(.15).call(function(){t._canMoveBoard=!0,t._maxObj>=16&&0==t._canInstanceUnit&&cc.log("end Game"),0!=t._canInstanceUnit&&(t._canInstanceUnit=!1,t.instanceRandomUnit())}).start()},instanceBackgroundUnit:function(){for(var t=1;t<=this._row;t++){for(var e=[],n=1;n<=this._col;n++){var i=cc.instantiate(this.unitBG),o=cc.v2((n-(this._col+1)/2)*this._distance,-(t-(this._row+1)/2)*this._distance);i.position=o,e.push(o),this.nodeBG.addChild(i)}this._boardPosition.push(e)}},_startGameFunc:function(){i.instance.emit("playSoundClick"),i.instance.emit("playSoundBackground"),this._clearBoardGame(),this.instanceRandomUnit(),this.instanceRandomUnit()},_instanceBoardArray:function(){for(var t=0;t<this._row;t++){for(var e=[],n=0;n<this._col;n++)e.push(null);this._boardUnitArgs.push(e)}},_clearBoardGame:function(){for(var t=0;t<this._row;t++)for(var e=0;e<this._col;e++)null!=this._boardUnitArgs[t][e]&&this._boardUnitArgs[t][e].destroyNode(),this._boardUnitArgs[t][e]=null;this._maxObj=0,this._resetScore()},_moveUp:function(){if(0!=this._canMoveBoard){this._canMoveBoard=!1;for(var t=0;t<this._col;t++)for(var e=0;e<this._row;e++){var n=this._getIndex(e,t,"col","forward");n!=e&&(null!=this._boardUnitArgs[e][t]?this._boardUnitArgs[e][t].getUnitValue()!=this._boardUnitArgs[n][t].getUnitValue()?this._moveUnitPosition(n,t,e+1,t):(this._moveUnitPosition(n,t,e,t),this._mergeUnit(e,t,n,t)):(this._moveUnitPosition(n,t,e,t),n!=t&&t--))}this._instanceUnit()}},_moveDown:function(){if(0!=this._canMoveBoard){this._canMoveBoard=!1;for(var t=this._col-1;t>=0;t--)for(var e=this._row-1;e>=0;e--){var n=this._getIndex(e,t,"col","backward");n!=e&&(null!=this._boardUnitArgs[e][t]?this._boardUnitArgs[e][t].getUnitValue()!=this._boardUnitArgs[n][t].getUnitValue()?this._moveUnitPosition(n,t,e-1,t):(this._moveUnitPosition(n,t,e,t),this._mergeUnit(e,t,n,t)):(this._moveUnitPosition(n,t,e,t),n!=t&&t++))}this._instanceUnit()}},_moveLeft:function(){if(0!=this._canMoveBoard){this._canMoveBoard=!1;for(var t=0;t<this._row;t++)for(var e=0;e<this._col;e++){var n=this._getIndex(t,e,"row","forward");n!=e&&(null!=this._boardUnitArgs[t][e]?this._boardUnitArgs[t][e].getUnitValue()!=this._boardUnitArgs[t][n].getUnitValue()?this._moveUnitPosition(t,n,t,e+1):(this._moveUnitPosition(t,n,t,e),this._mergeUnit(t,e,t,n)):(this._moveUnitPosition(t,n,t,e),n!=e&&e--))}this._instanceUnit()}},_moveRight:function(){if(0!=this._canMoveBoard){this._canMoveBoard=!1;for(var t=this._row-1;t>=0;t--)for(var e=this._col-1;e>=0;e--){var n=this._getIndex(t,e,"row","backward");n!=e&&(null!=this._boardUnitArgs[t][e]?this._boardUnitArgs[t][e].getUnitValue()!=this._boardUnitArgs[t][n].getUnitValue()?this._moveUnitPosition(t,n,t,e-1):(this._moveUnitPosition(t,n,t,e),this._mergeUnit(t,e,t,n)):(this._moveUnitPosition(t,n,t,e),n!=e&&e++))}this._instanceUnit()}},_moveUnitPosition:function(t,e,n,i){if(t!=n||e!=i){var o=this._boardUnitArgs[t][e];this._boardUnitArgs[t][e]=this._boardUnitArgs[n][i],this._boardUnitArgs[n][i]=o,this._boardUnitArgs[n][i].moveUnit(this._boardPosition[n][i]),this._canInstanceUnit=!0}},_mergeUnit:function(t,e,n,o){i.instance.emit("playSoundAward"),this._boardUnitArgs[t][e].setUnitValue(2*this._boardUnitArgs[t][e].getUnitValue()),this._boardUnitArgs[n][o].destroyNode(),this._boardUnitArgs[n][o]=null,this._addScore(this._boardUnitArgs[t][e].getUnitValue()),this._maxObj--},_getIndex:function(t,e,n,i){var o=null;if("row"==n){if(o=e,"forward"==i)for(var r=this._col-1;r>e;r--)null!=this._boardUnitArgs[t][r]&&(o=r);if("backward"==i)for(var s=0;s<e;s++)null!=this._boardUnitArgs[t][s]&&(o=s)}if("col"==n){if(o=t,"forward"==i)for(var c=this._row-1;c>t;c--)null!=this._boardUnitArgs[c][e]&&(o=c);if("backward"==i)for(var a=0;a<t;a++)null!=this._boardUnitArgs[a][e]&&(o=a)}return o},_addScore:function(t){this.scoreTotal.string=+t+ +this.scoreTotal.string,this._updateBestScore()},_resetScore:function(){this.scoreTotal.string=0,cc.sys.localStorage.getItem("BestScore")?this.bestScore.string=cc.sys.localStorage.getItem("BestScore"):this.bestScore.string=0},_updateBestScore:function(){+this.scoreTotal.string>+this.bestScore.string&&(this.bestScore.string=this.scoreTotal.string,cc.sys.localStorage.setItem("BestScore",+this.bestScore.string))}}),cc._RF.pop()},{Emitter:"Emitter"}],KeyboardController:[function(t,e,n){"use strict";cc._RF.push(e,"01b53iQwulP+oeV57sueIqk","KeyboardController");var i=t("Emitter");cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},onKeyUp:function(t){switch(t.keyCode){case cc.macro.KEY.up:i.instance.emit("moveUp");break;case cc.macro.KEY.down:i.instance.emit("moveDown");break;case cc.macro.KEY.left:i.instance.emit("moveLeft");break;case cc.macro.KEY.right:i.instance.emit("moveRight")}}}),cc._RF.pop()},{Emitter:"Emitter"}],MainMenuController:[function(t,e,n){"use strict";cc._RF.push(e,"1df2cMwkNpNDaW6XcbddVwk","MainMenuController");var i=t("Emitter");cc.Class({extends:cc.Component,properties:{newGameBtn:cc.Button,startGameBtn:cc.Button,startGameBtnLabel:cc.Label,backMenuBtn:cc.Button,exitBtn:cc.Button,gamePlayNode:cc.Node,menuNode:cc.Node},onLoad:function(){this.newGameBtn.node.on("click",this._newGameFunc,this),this.startGameBtn.node.on("click",this._startGameFunc,this),this.backMenuBtn.node.on("click",this._backMenuFunc,this),this.exitBtn.node.on("click",this._exitGame,this),this.exitBtn.node.on("click",this._exitGame,this),this.gamePlayNode.active=!1,this.menuNode.active=!0},_newGameFunc:function(){i.instance.emit("playSoundClick"),this._move(-1e3,0,this.menuNode,1,!1),this._move(-1e3,0,this.gamePlayNode,1,!0)},_backMenuFunc:function(){i.instance.emit("playSoundClick"),this._move(1e3,0,this.menuNode,1,!0),this._move(1e3,0,this.gamePlayNode,1,!1)},_move:function(t,e,n,i,o){var r=0;1==o&&(r=255);var s=cc.tween;s(n).call(function(){1==o&&(n.active=o)}).parallel(s().by(i,{position:cc.v2(t,e)},{easing:"quartOut"}),s().to(i/5,{opacity:r})).call(function(){0==o&&(n.active=o)}).start()},_exitGame:function(){cc.game.end()},_startGameFunc:function(){i.instance.emit("startGame"),this.startGameBtnLabel.string="RePlay"}}),cc._RF.pop()},{Emitter:"Emitter"}],SoundController:[function(t,e,n){"use strict";cc._RF.push(e,"7ffc1PhCJRDT4YHwEGDUvDY","SoundController");var i=t("Emitter");cc.Class({extends:cc.Component,properties:{clickAudio:cc.AudioSource,slideAudio:cc.AudioSource,awardAudio:cc.AudioSource,soundBackground:cc.AudioSource},onLoad:function(){var t=this;i.instance.addEvent("playSoundBG",function(){t.soundBackground.play()}),i.instance.addEvent("playSoundClick",this._playSoundClick.bind(this)),i.instance.addEvent("playSoundSlide",this._playSoundSlide.bind(this)),i.instance.addEvent("playSoundAward",this._playSoundAward.bind(this)),i.instance.addEvent("playSoundBackground",this._playSoundBackground.bind(this))},_playSoundClick:function(){this.clickAudio.play()},_playSoundSlide:function(){this.slideAudio.play()},_playSoundAward:function(){this.awardAudio.play()},_playSoundBackground:function(){this.soundBackground.play()}}),cc._RF.pop()},{Emitter:"Emitter"}],TouchController:[function(t,e,n){"use strict";cc._RF.push(e,"216c9bKAjhCZ5olErtOhkcp","TouchController");var i=t("Emitter");cc.Class({extends:cc.Component,properties:{_starPos:null,_endPos:null},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this,!0)},onTouchStart:function(t){this._starPos=t.getLocation()},onTouchEnd:function(t){this._endPos=t.getLocation(),this._checkDirect()},_checkDirect:function(){var t=this._endPos.x-this._starPos.x,e=this._endPos.y-this._starPos.y;if(Math.abs(t)>Math.abs(e)){if(t<30&&t>-30)return;t>0?i.instance.emit("moveRight"):i.instance.emit("moveLeft")}else{if(e<30&&e>-30)return;e>0?i.instance.emit("moveUp"):i.instance.emit("moveDown")}}}),cc._RF.pop()},{Emitter:"Emitter"}],UnitColor:[function(t,e,n){"use strict";cc._RF.push(e,"802ccicE3VHX44rJathQXDa","UnitColor");var i={VALUE_2:cc.color(255,255,255,255),VALUE_4:cc.color(150,200,160,255),VALUE_8:cc.color(210,90,160,255),VALUE_16:cc.color(160,100,65,255),VALUE_32:cc.color(230,115,120,255),VALUE_64:cc.color(190,75,210,255),VALUE_128:cc.color(220,160,150,255),VALUE_256:cc.color(105,195,230,255),VALUE_512:cc.color(180,230,100,255),VALUE_1024:cc.color(220,108,170,255),VALUE_2048:cc.color(170,35,40,255),VALUE_4096:cc.color(140,75,40,255),VALUE_8192:cc.color(140,75,40,255)};e.exports=i,cc._RF.pop()},{}],Unit:[function(t,e,n){"use strict";cc._RF.push(e,"0c10ftwO29MtYIZFvB+jB67","Unit");t("Emitter");var i=t("./UnitColor");cc.Class({extends:cc.Component,properties:{sprite:cc.Sprite,valueLable:cc.Label,unitValue:0,moveValue:200},onLoad:function(){this.node.destroyNode=this._destroyNode.bind(this),this.node.moveUnit=this._moveUnit.bind(this),this.node.getUnitValue=this._getUnitValue.bind(this),this.node.setUnitValue=this._setUnitValue.bind(this)},_destroyNode:function(){this.node.destroyNode=null,this.node.moveUnit=null,this.node.getUnitValue=null,this.node.setUnitValue=null,this.node.destroy()},_moveUnit:function(t){cc.tween(this.node).to(.04,{position:t}).start()},_getUnitValue:function(){return this.unitValue},_setUnitValue:function(t){this.valueLable.string=t,this.unitValue=t,this._changeColorSprite(t),cc.tween(this.node).to(.04,{scale:1.1},{easing:"elasticOut"}).to(.04,{scale:1}).start()},_changeColorSprite:function(t){switch(t){case 2:this.sprite.node.color=i.VALUE_2;break;case 4:this.sprite.node.color=i.VALUE_4;break;case 8:this.sprite.node.color=i.VALUE_8;break;case 16:this.sprite.node.color=i.VALUE_16;break;case 32:this.sprite.node.color=i.VALUE_32;break;case 64:this.sprite.node.color=i.VALUE_64;break;case 128:this.sprite.node.color=i.VALUE_128;break;case 256:this.sprite.node.color=i.VALUE_256;break;case 512:this.sprite.node.color=i.VALUE_512;break;case 1024:this.sprite.node.color=i.VALUE_1024;break;case 2048:this.sprite.node.color=i.VALUE_2048;break;case 4096:this.sprite.node.color=i.VALUE_4096;break;case 8192:this.sprite.node.color=i.VALUE_8192}}}),cc._RF.pop()},{"./UnitColor":"UnitColor",Emitter:"Emitter"}]},{},["GameController","MainMenuController","SoundController","Emitter","EventController","KeyboardController","TouchController","Unit","UnitColor"]);